<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>Neon Snake</title>
    <style>
        /* 1. 全局防误触设置：禁止长按弹出菜单，禁止选择文字 */
        body, canvas, button {
            margin: 0;
            background: #000;
            color: #fff;
            font-family: monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            touch-action: none; /* 禁止浏览器默认的滚动/缩放 */
            -webkit-touch-callout: none; /* iOS 禁止长按菜单 */
            -webkit-user-select: none;   /* iOS 禁止选文字 */
            user-select: none;
        }

        canvas {
            border: 2px solid #333;
            box-shadow: 0 0 20px #0f0;
            max-width: 95vw; /* 手机上不撑破屏幕 */
            max-height: 50vh; /* 留出空间给按钮 */
        }

        #ui {
            width: 380px;
            max-width: 95vw;
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #0f0;
            font-size: 20px;
            font-weight: bold;
        }

        /* 2. 手机端控制按钮区 */
        #ctrl {
            display: none; /* 电脑默认隐藏 */
            margin-top: 20px;
            grid-template-columns: 60px 60px 60px;
            grid-template-rows: 60px 60px;
            gap: 10px;
        }

        /* 只有手机显示按钮 */
        @media(max-width: 800px) {
            #ctrl { display: grid; }
        }

        /* 按钮样式 */
        .btn {
            background: #111;
            border: 2px solid #0f0;
            color: #0f0;
            font-size: 24px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .btn:active { background: #0f0; color: #000; } /* 按下发光 */

        /* 布局定位 */
        #b-up { grid-column: 2; grid-row: 1; }
        #b-left { grid-column: 1; grid-row: 2; }
        #b-down { grid-column: 2; grid-row: 2; }
        #b-right { grid-column: 3; grid-row: 2; }

    </style>
</head>
<body>

    <div id="ui">
        <span>SCORE: <span id="sc">0</span></span>
        <span>HI: <span id="hi">0</span></span>
    </div>

    <canvas id="c" width="400" height="400"></canvas>

    <div id="ctrl">
        <div class="btn" id="b-up">▲</div>
        <div class="btn" id="b-left">◀</div>
        <div class="btn" id="b-down">▼</div>
        <div class="btn" id="b-right">▶</div>
    </div>

    <script>
        const c=document.getElementById('c'),x=c.getContext('2d'),S=document.getElementById('sc'),H=document.getElementById('hi');
        let gs=20,tc=20,ax=ay=10,xv=yv=0,tr=[],tl=5,sc=0,h=localStorage.getItem('s_hi')||0;H.innerText=h;
        
        // 游戏主循环
        function g(){
            ax+=xv;ay+=yv;
            // 穿墙逻辑
            if(ax<0)ax=tc-1;if(ax>tc-1)ax=0;if(ay<0)ay=tc-1;if(ay>tc-1)ay=0;
            
            // 绘制背景
            x.fillStyle='#000';x.fillRect(0,0,400,400);
            
            // 绘制蛇
            x.fillStyle='#0f0';x.shadowBlur=15;x.shadowColor='#0f0';
            for(let i=0;i<tr.length;i++){
                x.fillRect(tr[i].x*gs,tr[i].y*gs,gs-2,gs-2);
                if(tr[i].x==ax&&tr[i].y==ay){tl=5;sc=0;S.innerText=0;} // 撞自己死亡
            }
            tr.push({x:ax,y:ay});while(tr.length>tl)tr.shift();
            
            // 吃食物
            if(ax==fx&&ay==fy){
                tl++;sc+=10;
                if(sc>h){h=sc;localStorage.setItem('s_hi',h);H.innerText=h}
                S.innerText=sc;sp();
            }
            
            // 绘制食物
            x.fillStyle='#f0f';x.shadowColor='#f0f';x.beginPath();x.arc(fx*gs+10,fy*gs+10,8,0,6.28);x.fill();x.shadowBlur=0;
        }

        // 生成食物
        function sp(){fx=Math.floor(Math.random()*tc);fy=Math.floor(Math.random()*tc);}

        // 键盘监听
        document.addEventListener('keydown',e=>{
            switch(e.keyCode){
                case 37:if(xv!=1){xv=-1;yv=0}break;
                case 38:if(yv!=1){xv=0;yv=-1}break;
                case 39:if(xv!=-1){xv=1;yv=0}break;
                case 40:if(yv!=-1){xv=0;yv=1}break;
            }
        });

        // 触摸按钮监听 (绑定到 div)
        function bindBtn(id, dx, dy) {
            const btn = document.getElementById(id);
            // 阻止默认事件，防止双击缩放或长按菜单
            btn.addEventListener('touchstart', (e) => { 
                e.preventDefault(); 
                if(dx==1 && xv!=-1) {xv=1;yv=0}
                if(dx==-1 && xv!=1) {xv=-1;yv=0}
                if(dy==1 && yv!=-1) {xv=0;yv=1}
                if(dy==-1 && yv!=1) {xv=0;yv=-1}
            }, {passive: false});
        }

        bindBtn('b-up', 0, -1);
        bindBtn('b-down', 0, 1);
        bindBtn('b-left', -1, 0);
        bindBtn('b-right', 1, 0);

        // 启动
        sp();setInterval(g,1000/10); // 速度设置 10FPS
    </script>
</body>
</html>